<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pro1 SailfishOS Installation Guide</title>
	<link rel="icon" type="image/x-icon" href="res/favicon.webp">
	<style>
		html {
			font-family: sans-serif;
			color: black;
		}

		body {
			background: #f2f2f2;
		}

		h1,
		h2 {
			position: sticky;
			top: 0;
		}

		h1,
		h2,
		h3 {
			background: #ffffffed;
			padding-top: 20px;
			padding-bottom: 4px;
			font-weight: 400;
		}

		.code {
			font-family: monospace;
			transition: background;
			transition-duration: 1s;
		}

		.code:hover {
			background: #e9e9e9;
			transition: background;
			transition-duration: 0.3s;
		}

		span.code {
			background: lightgray;
			padding: 3px;
			margin: 1px;
		}

		div.code {
			background: lightgray;
			display: inline-block;
			padding: 15px;
			margin-left: 30px;
			white-space: nowrap;
			overflow-x: auto;
			max-width: -webkit-fill-available;
			border-top-left-radius: 30px;
			border-bottom-right-radius: 30px;
		}

		.card {
			background: white;
			max-width: 1000px;
			padding-bottom: 20px;
			padding-left: 20px;
			padding-right: 20px;
			margin: 0 auto;
			margin-bottom: 20px;
			box-shadow: 5px 5px 5px lightgray;
		}

		.card:nth-child(4n-3) {
			border-left: 15px solid #1d5997;
		}

		.card:nth-child(4n-2) {
			border-left: 15px solid #347e16;
		}

		.card:nth-child(4n-1) {
			border-left: 15px solid #fcd75f;
		}

		.card:nth-child(4n) {
			border-left: 15px solid #993300;
		}
	</style>
</head>

<body>
	<div class="card">
		<h1>SailfishOS on the Pro1: Installation guide</h1>

		<p>So you want to run SailfishOS? Alright.
		<p>

		<p>You must take the long path to prove your worthiness <i style="font-size: x-small">and/or to avoid
				bootloops.</i></p>

		<p>(If you skip straight to the latest release, it probably won't work. You need to go from Stock > 3.3 > 3.4 > 4.0 > 4.1 > 4.2
			> 4.3 > ....)</p>

		<p>(If you try to install over LineageOS without flashing back to stock first, it also might not work...)</p>

		<h3>Content</h3>
		<a href="#pie">Flash to Stock (Pie)</a><br>
		<a href="#rokua">Install Sailfish OS 3.3 (Rokua)</a><br>
		<a href="#pallas">Upgrade from Sailfish 3.3 to 3.4 (Pallas-Yllästunturi)</a><br>
		<a href="#koli">Upgrade from Sailfish 3.4 to 4.0 (Koli)</a><br>
		<a href="#kvarken">Upgrade from Sailfish OS 4.0 to 4.1 (Kvarken)</a><br>
		<a href="#verla">Upgrade from Sailfish OS 4.1 to 4.2 (Verla)</a><br>
		<a href="#suomenlinna">Upgrade from Sailfish OS 4.2 to 4.3 (Suomenlinna)</a><br>
		<a href="#vanha">Upgrade from Sailfish OS 4.3 to 4.4 (Vanha Rauma)</a><br>
		<a href="#post">Post-installation stuff</a><br>
		<a href="#maintenance">Maintenance stuff</a><br>
	</div>

	<div class="card">
		<h2 id="pie">Flash to Stock (Pie)<a></h2>
		<p>Reference: <a
				href="https://community.fxtec.com/topic/2466-guide-restore-to-stock-firmware-using-fastboot-method/">https://community.fxtec.com/topic/2466-guide-restore-to-stock-firmware-using-fastboot-method/</a>
		</p>

		<ul>
			<li>Download the stock files from <a
					href="https://drive.google.com/file/d/1lEc-ummPsamKDWHpoJP6YJcH6IYS4abe/view">here</a></li>
			<li>If you are running Android, enable developer mode, then enable USB debugging</li>
			<li>On your computer, open a terminal and type <span class="code">adb reboot bootloader</span></li>
			<li>If you are coming from a SailfishOS version, enable developer mode. Connect to <span class="code">ssh defaultuser@192.168.2.15</span> from your computer, become <span class="code">devel-su</span> and issue <span class="code">reboot bootloader</span></li>
			<li>In case your device does not boot into any OS currently, you can alternatively access the fastboot bootloader menu by pressing the volume down key during the first second of the boot process.</li>
		</ul>

                <p>Now you are in the fastboot bootloader menu. Run the following commands or create a script from them as described below:</p>
		<p>
		<div class="code">
			fastboot flash boot_a boot.img<br>
			fastboot flash boot_b boot.img<br>
			fastboot flash dtbo_a dtbo.img <br>
			fastboot flash dtbo_b dtbo.img <br>
			fastboot flash system_a system.img<br>
			fastboot flash system_b system.img<br>
			fastboot flash vendor_a vendor.img <br>
			fastboot flash vendor_b vendor.img<br>
			fastboot flash vbmeta_a vbmeta.img <br>
			fastboot flash vbmeta_b vbmeta.img <br>
			fastboot flash userdata userdata.img <br>
			fastboot flash abl_a abl.elf <br>
			fastboot flash abl_b abl.elf <br>
			fastboot flash persist persist.img<bR>
			fastboot flash mdtp_a mdtp.img<br>
			fastboot flash mdtp_b mdtp.img <br>
			fastboot flash splash splash.img<br>
			fastboot flash xbl_a xbl.elf <br>
			fastboot flash xbl_b xbl.elf<br>
			fastboot flash rpm_a rpm.mbn<br>
			fastboot flash rpm_b rpm.mbn<br>
			fastboot flash tz_a tz.mbn<br>
			fastboot flash tz_b tz.mbn<br>
			fastboot flash hyp_a hyp.mbn<br>
			fastboot flash hyp_b hyp.mbn<br>
			fastboot flash pmic_a pmic.elf<br>
			fastboot flash pmic_b pmic.elf<br>
			fastboot flash modem_a NON-HLOS.bin<br>
			fastboot flash modem_b NON-HLOS.bin<br>
			fastboot flash keymaster_a km4.mbn<br>
			fastboot flash keymaster_b km4.mbn<br>
			fastboot flash cmnlib_a cmnlib.mbn<br>
			fastboot flash cmnlib_b cmnlib.mbn<br>
			fastboot flash cmnlib64_a cmnlib64.mbn<br>
			fastboot flash cmnlib64_b cmnlib64.mbn<br>
			fastboot flash bluetooth_a BTFM.bin<br>
			fastboot flash bluetooth_b BTFM.bin<br>
			fastboot flash dsp_a adspso.bin<br>
			fastboot flash dsp_b adspso.bin<br>
			fastboot flash devcfg_a devcfg.mbn<br>
			fastboot flash devcfg_b devcfg.mbn<br>
			fastboot flash mdtpsecapp_a mdtpsecapp.mbn<br>
			fastboot flash mdtpsecapp_b mdtpsecapp.mbn<br>
			fastboot flash storsec storsec.mbn
		</div>
		</p>

		<p>Suggestion: copy the commands and save as a bash script, then just run the script instead of running each
			command individually.</p>

                <p>To do so, copy and paste above fastboot commands into a script, e.g. <span class="code">nano flash-stock.sh</span>. Add <span class="code">#!/bin/bash</span>
		        as first line. Save what you pasted into nano using <span class="code">ctrl+o</span>. Exit nano with <span class="code">ctrl+x</span> and make the script executable
			using <span class="code">chmod +x flash-stock.sh</span>.<br>Now you are ready to start the script and thus execute all commands sequentially
			by executing <span class="code">./flash-stock.sh</span>.</p>

		<p>Next run <span class="code">fastboot reboot</span></p>

		<p>Your Pro1 is now flashed back to stock.</p>

		<p>At this point, I went through the Android 9.0 setup and enabled developer mode and USB debugging again. Might
			be possible to skip this last step...</p>

	</div>

	<div class="card">
		<h2 id="rokua">Install Sailfish OS 3.3 (Rokua)</h2>
		<p>Reference: <a
				href="https://community.fxtec.com/topic/2467-community-build33016updated-18th-aug-sailfish-os-for-fxtec-pro1/">https://community.fxtec.com/topic/2467-community-build33016updated-18th-aug-sailfish-os-for-fxtec-pro1/</a>
		</p>

		<h3>Requirements</h3>
		<ul>
			<li>A microSD card</li>
		</ul>

		<h3>Process</h3>

		<ul>
			<li>Download the TWRP file (twrp-3.3.1-qx1000.img) from <a
					href="https://drive.google.com/open?id=1IgUjxEKV5MU_3cRkNCyGc-YpRkUQ3xHh">here</a></li>
			<li>Download the SailfishOS 3.3 image (sailfishos-t5-release-3.3.0.16-devel-20200507.zip) from <a
					href="https://gitlab.com/sailfishos-porters-ci/t5-ci/-/jobs/542508839/artifacts/browse/sfe-t5-3.3.0.16-devel-20200507/">here</a>
			</li>
			<li>Copy the SailfishOS 3.3 image to the microSD card (do not unzip) and insert the microSD card into the
				Pro1</li>
			<li>Reboot your Pro1 to the bootloader (<span class="code">adb reboot bootloader</span>)</li>
			<li>On your computer, run <span class="code">fastboot set_active a</span></li>
			<li>On your computer, run <span class="code">fastboot flash boot twrp-3.3.1-qx1000.img</span></li>
			<li>On the Pro1, use the volume buttons to switch to "Recovery Mode", then press the power button to select
			</li>
			<li>In TWRP go to Wipe > Format Data then type yes and click the blue tick</li>
			<li>When the format is complete then go back three times, choose reboot, then choose reboot into recovery
				(swipe to confirm)</li>
			<li>Select "install" then select storage SD, then click install zip</li>
			<li>Navigate to where you put the zip on the microSD card and click it</li>
			<li>Swipe to install</li>
			<li>Choose reboot</li>
		</ul>

		<p>You now have SailfishOS! Great choice btw.</p>

	</div>

	<div class="card">

		<h2 id="pallas">Upgrade from Sailfish 3.3 to 3.4 (Pallas-Yllästunturi)</h2>

		<p>Reference: <a
				href="https://community.fxtec.com/topic/2467-community-build33016updated-18th-aug-sailfish-os-for-fxtec-pro1/page/8/?tab=comments#comment-54413">https://community.fxtec.com/topic/2467-community-build33016updated-18th-aug-sailfish-os-for-fxtec-pro1/page/8/?tab=comments#comment-54413</a>
		</p>

		<h3>Requirements</h3>
		<ul>
			<li>A linux machine to run the flash.sh script on</li>
			<li>Not minding the fact that this will wipe your 3.3 install (backup your files if you have any...)</li>
		</ul>

		<h3>Process</h3>

		<ul>
			<li>Download the 3.4 files (Sailfish_OS--devel-20201125-3.4.0.24-t5-0.0.1.2.zip) from <a
					href="https://gitlab.com/sailfishos-porters-ci/t5-ci/-/jobs/871937492/artifacts/file/sfe-t5-3.4.0.24-devel-20201125/Sailfish_OS--devel-20201125-3.4.0.24-t5-0.0.1.2.zip">here</a>
			</li>
			<li>Extract the zip file (just once)</li>
			<li>Put the Pro1 into fastboot mode. Either by issuing <span class="code">reboot bootloader</span>
			        while connected via SSH (Developer Mode). Or by turning the phone off, then turning it back on holding
				the volume-down and power buttons)</li>
			<li>On your computer, in a terminal, in the folder you extracted, run <span class="code">sudo
					./flash.sh</span></li>
			<li>Then reboot the phone (<span class="code">fastboot reboot</span>)</li>
		</ul>

		<p>You should now have a SailfishOS 3.4 install!</p>

	</div>

	<div class="card">

		<h2 id="koli">Upgrade from Sailfish 3.4 to 4.0 (Koli)</h2>

		<ul>
			<li>In SailfishOS, open Settings</li>
			<li>Go to Developer tools</li>
			<li>Set a password under the Remote connection option</li>
			<li>Open the Terminal app then run the following commands:</li>
		</ul>

		<p>
		<div class="code">
			devel-su<br>
			ssu re 4.0.1.48<br>
			ssu ur<br>
			zypper ref<br>
			zypper dup
		</div>
		</p>

		<p>My Pro1 crashed at this point, but after a powercycle I had a perfectly functional 4.0 install. Complete with
			the ugly lighthouse ambiance.</p>
		<p>You should reboot, in any case.</p>

		<p><i>Optional note:<br>The CPU gets downclocked when the Pro1 goes into sleep mode.<br>Consider setting the
				screen timeout to 10 minutes to make things run faster!</i></p>
	</div>

	<div class="card">

		<h2 id="kvarken">Upgrade from 4.0 to 4.1 (Kvarken)</h2>

		<p>Same thing as the 3.4 to 4.0 install, just change the number when running ssu re.</p>

		<p>
		<div class="code">
			devel-su<br>
			ssu re 4.1.0.24<br>
			ssu ur<br>
			zypper ref<br>
			zypper dup
		</div>
		</p>
		<p>Reboot when you're done.</p>

	</div>

	<div class="card">
		<h2 id="verla">Upgrade from Sailfish OS 4.1 to 4.2 (Verla)</h2>
		<p>Same thing again, just change the number.</p>

		<div class="code">
			devel-su<br>
			ssu re 4.2.0.21<br>
			ssu ur<br>
			zypper ref<br>
			zypper dup
		</div>

		<p>Reboot when you're done.</p>
	</div>
	<div class="card">
		<h2 id="suomenlinna">Upgrade from Sailfish OS 4.2 to 4.3 (Suomenlinna)</h2>
		<p>Same thing yet again, just change the number.</p>

		<div class="code">
			devel-su<br>
			ssu re 4.3.0.12<br>
			ssu ur<br>
			zypper ref<br>
			zypper dup
		</div>
		<p>Reboot when you're done.</p>

	</div>
	<div class="card">
		<h2 id="vanha">Upgrade from Sailfish OS 4.3 to 4.4 (Vanha Rauma)</h2>
		<p>This time, it is advised to update the 4.3 install again before actually updating to 4.4. Especially when updating an old 4.3 install.</p>

		<div class="code">
			devel-su<br>
			zypper ref<br>
			zypper dup<br>
			ssu re 4.4.0.58<br>
			ssu ur<br>
			zypper ref<br>
			zypper dup
		</div>

		<p>Reboot when you're done.</p>

		<p>In case you are left with no network connection for all Sailjail apps, there are two possible culprits.</p>

		<p>Dnsmasq might have wrongly been activated by the systemd update. Disable it with:</p>

		<div class="code">
			systemctl disable dnsmasq<br>
		</div>

		<p>Another quirk could be the resolv.conf not being visible from inside the Sailjail. Check if your /etc/resolv.conf symlink still points to /var/run/connman/resolv.conf. Change it to /run/connman/resolv.conf and restart the browser booster.</p>

		<div class="code">
			ls -l /etc/resolv.conf<br>
			rm -f /etc/resolv.conf<br>
			ln -s /run/connman/resolv.conf /etc/resolv.conf<br>
			systemctl --user restart booster-browser@sailfish-browser.service<br>
		</div>

	</div>
	<div class="card">
		<h2 id="post">Post-installation stuff</h2>
		<h3>Homescreen rotation fix</h3>
		<div class="code">
			sed -e "s/return allowed/return Orientation.All/" -i  /usr/lib/qt5/qml/Sailfish/Silica/Page.qml
		</div>
		<p>Reboot or restart lipstick as root/devel-su with <span class="code">systemctl --user restart lipstick</span> to apply changes</p>

		<h3>Choose hardware keyboard layout</h3>
		<div class="code">
			dconf write /desktop/lipstick-jolla-home/model \"fxtecpro1\"<br>
			dconf write /desktop/lipstick-jolla-home/layout \"LAYOUT\"
		</div>
		<p>Replace <span class="code">LAYOUT</span> with a country code from <span class="code">/usr/share/X11/xkb/symbols/fxtec_vndr/pro1</span></p>
		<p>For US English layout use "us"</p>

		<h3>My camera doesn't work! (fix only applies to 4.3.0.12)</h3>
		<p>Reference: <a href="https://forum.sailfishos.org/t/4-3-0-12-jolla-camera-also-torch-does-not-start-at-all-as-well-as-videos-do-not-play/9000/62">https://forum.sailfishos.org/t/4-3-0-12-jolla-camera-also-torch-does-not-start-at-all-as-well-as-videos-do-not-play/9000/62</a></p>
		<div class="code">
			devel-su<br>
			ssu rr adaptation-common<br>
			rm -r /var/cache/ssu/<br>
			ssu ur<br>
			pkcon refresh<br>
			version --dup<br>
			reboot
		</div>
		<p>If your camera works, you don't need to do this.</p>
	</div>
	<div class="card">
		<h2 id="maintenance">Maintenance stuff</h2>
		<h3>Fixing touch guestures after display change</h3>
		<p>After a change of the display it might be necessary to update the firmware of the display controller if the display doesn't react to touch gestures on the curved part.</p>

		<p>Requirements</p>
		<ul>
			<li>To be able to update the firmware the Linux kernel has to have the enabled option "CONFIG_GTP_AUTO_UPDATE=y":<br><span class="code">zcat /proc/config.gz | grep CONFIG_GTP_AUTO_UPDATE</span></li>
			<li>The display firmware file: <a href="res/gt1x_fw.bin">gt1x_fw.bin</a></li>
		</ul>

		<p>Process</p>
		<ul>
			<li>Create a directory and store the firmware file in it: <span class="code">mkdir -p /lib/firmware</span></li>
			<li>Add the new directory to the list of directories in the beginning of this script: <span class="code">vi /usr/bin/droid/droid-load-firmware.sh</span></li>
			<li>Reboot. Now the display should react to touches on the curved part of the screen again.</li>
			<li>Remove the added directory in /usr/bin/droid/droid-load-firmware.sh and/or the firmware file in /lib/firmware to avoid flashing the firmware after every restart of the device.</li>
		</ul>
	</div>
	<div class="card"
		style="color: darkgray; padding-top: 5px; padding-bottom: 5px; border-left-color: white; text-align: right; border-top-left-radius: 50px; border-bottom-right-radius: 50px;">
		<p style="padding-right: 20px">Publication date: 2022-01-08<br>Updated: 2022-04-09<br>
		        Version: v0.2.6</p>
	</div>
</body>

</html>
